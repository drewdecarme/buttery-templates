#! /usr/bin/env node
import { program } from "commander";
import { glob } from "glob";
import type { CLIConfig } from "../types/index.js";
import { buildProgramFromFiles } from "./util.build-program-from-files.js";
import { fileURLToPath, resolve } from "node:url";
import path from "path";

import("./{{cli_name}}.config.js").then(async ({ default: config }) => {
  // Add the name and the description of the CLI
  program.name(config.name).description(config.description);

  const commandsDir = path.resolve(config.root, "./commands");
  const commandFilePaths = glob.sync(path.resolve(commandsDir, "./**.js"), {
    follow: false,
  });
  
  await buildProgramFromFiles({
    command: program,
    commandsDir,
    commandFilePaths
  });
  await program.parseAsync();
}).catch(error => {
  console.error(error);
  throw new Error(error);
})


